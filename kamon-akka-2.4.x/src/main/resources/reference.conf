# ================================== #
# Kamon-Akka Reference Configuration #
# ================================== #

kamon {
  akka {
    # If ask-pattern-timeout-warning is enabled, a WARN level log message will be generated if a future generated by the `ask`
    # pattern fails with a `AskTimeoutException` and the log message will contain information depending of the strategy selected.
    # strategies:
    #   - off: nothing to do.
    #   - lightweight: logs the warning when a timeout is reached using org.aspectj.lang.reflect.SourceLocation.
    #   - heavyweight: logs the warning when a timeout is reached using a stack trace captured at the moment the future was created.
    ask-pattern-timeout-warning = off

    # Filter names from which actor groups will be created. Setting up actor groups require two steps: first, define
    # a filter under the kamon.util.filters key and second, add that filter to this key. E.g.: for the following config:
    #
    # kamon.util.filters {
    #   worker-actors {
    #     includes = ["my-system/user/application/worker-*", "my-system/user/workers/**"]
    #     excludes = [ ]
    #   }
    # }
    #
    # kamon.akka {
    #   actor-groups = [ "worker-actors" ]
    # }
    #
    # An actor group named "worker-actors" will be created and include all the actors whose path matches the provided
    # patterns.
    actor-groups = [ ]
  }

  util.filters {
    "akka.tracked-actor" {
      includes = [ ]
      excludes = [ "*/system/**", "*/user/IO-**" ]
    }

    "akka.tracked-router" {
      includes = [ ]
      excludes = [ ]
    }

    "akka.tracked-dispatcher" {
      includes = [ ]
      excludes = [ ]
    }

    "akka.traced-actor" {
      includes = [ ]
      excludes = [ ]
    }
  }

  modules {
    kamon-akka {
      requires-aspectj = yes
    }
  }
}

kanela {
  modules {
    akka24-module {
      name = "Akka 2.4.x Instrumentation Module"
      stoppable = false
      instrumentations = [
        "kamon.akka24.instrumentation.kanela.ActorSystemMessageInstrumentation",
        "kamon.akka24.instrumentation.kanela.RouterInstrumentation",
        "kamon.akka24.instrumentation.kanela.ActorInstrumentation",
        "kamon.akka24.instrumentation.kanela.EnvelopeInstrumentation",
        "kamon.akka24.instrumentation.kanela.DispatcherInstrumentation",
        "kamon.akka24.instrumentation.kanela.ActorLoggingInstrumentation",
        "kamon.akka24.instrumentation.kanela.AskPatternInstrumentation",
        "kamon.akka24.instrumentation.kanela.DeadLettersInstrumentation",
      ]
      within = [
        "akka.dispatch..*",
        "akka.event..*",
        "akka.actor..*",
        "akka.pattern..*",
        "akka.routing..*"
      ]
    }
  }
}